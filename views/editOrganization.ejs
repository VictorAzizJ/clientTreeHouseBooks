<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Edit Organization - TreeHouseBooks</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet"/>
  <link rel="stylesheet" href="/css/treehouse-brand.css">
</head>
<body>
  <%- include('partials/nav') %>
  <div class="container mt-5">

    <!-- Flash Messages -->
    <% if (typeof error !== 'undefined' && error) { %>
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <%= error %>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    <% } %>

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1><i class="bi bi-building-gear"></i> Edit Organization</h1>
      <div>
        <a href="/organizations/<%= organization._id %>" class="btn btn-secondary">
          <i class="bi bi-arrow-left"></i> Back to Details
        </a>
      </div>
    </div>

    <!-- Form -->
    <div class="card">
      <div class="card-body">
        <form action="/organizations/<%= organization._id %>" method="POST">
          <div class="row">
            <!-- Basic Information -->
            <div class="col-md-6">
              <h5 class="mb-3">Basic Information</h5>

              <div class="mb-3">
                <label for="name" class="form-label">Organization Name <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="name" name="name" required maxlength="200" value="<%= organization.name %>">
              </div>

              <div class="mb-3">
                <label for="organizationType" class="form-label">Organization Type</label>
                <select class="form-select" id="organizationType" name="organizationType">
                  <% organizationTypes.forEach(type => { %>
                    <option value="<%= type %>" <%= organization.organizationType === type ? 'selected' : '' %>><%= type.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase()) %></option>
                  <% }) %>
                </select>
              </div>

              <div class="mb-3">
                <label for="address" class="form-label">Address</label>
                <textarea class="form-control" id="address" name="address" rows="2" maxlength="500"><%= organization.address || '' %></textarea>
              </div>

              <div class="mb-3">
                <label for="zipCode" class="form-label">Zip Code</label>
                <input type="text" class="form-control" id="zipCode" name="zipCode" pattern="^\d{5}(-\d{4})?$" value="<%= organization.zipCode || '' %>" placeholder="12345 or 12345-6789">
              </div>
            </div>

            <!-- Contact & Additional Info -->
            <div class="col-md-6">
              <h5 class="mb-3">Contact Information</h5>

              <div class="mb-3">
                <label for="contactName" class="form-label">Contact Person</label>
                <input type="text" class="form-control" id="contactName" name="contactName" maxlength="100" value="<%= organization.contactName || '' %>" placeholder="Primary contact name">
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="phone" class="form-label">Phone</label>
                  <input type="tel" class="form-control" id="phone" name="phone" maxlength="20" value="<%= organization.phone || '' %>" placeholder="(555) 123-4567">
                </div>
                <div class="col-md-6 mb-3">
                  <label for="email" class="form-label">Email</label>
                  <input type="email" class="form-control" id="email" name="email" maxlength="100" value="<%= organization.email || '' %>" placeholder="contact@org.com">
                </div>
              </div>

              <div class="mb-3">
                <label for="contactMethod" class="form-label">Contact Notes</label>
                <textarea class="form-control" id="contactMethod" name="contactMethod" rows="2" maxlength="500"><%= organization.contactMethod || '' %></textarea>
              </div>

              <div class="mb-3">
                <label for="howHeardAboutUs" class="form-label">How They Heard About Us</label>
                <textarea class="form-control" id="howHeardAboutUs" name="howHeardAboutUs" rows="2" maxlength="500"><%= organization.howHeardAboutUs || '' %></textarea>
              </div>

              <div class="mb-3">
                <label for="notes" class="form-label">Notes</label>
                <textarea class="form-control" id="notes" name="notes" rows="3" maxlength="2000"><%= organization.notes || '' %></textarea>
              </div>
            </div>
          </div>

          <hr>

          <!-- Metadata (read-only) -->
          <div class="row mb-3">
            <div class="col-md-6">
              <small class="text-muted">
                <strong>Created:</strong> <%= new Date(organization.createdAt).toLocaleString() %>
              </small>
            </div>
            <% if (organization.updatedAt) { %>
              <div class="col-md-6">
                <small class="text-muted">
                  <strong>Last Updated:</strong> <%= new Date(organization.updatedAt).toLocaleString() %>
                </small>
              </div>
            <% } %>
          </div>

          <div class="d-flex justify-content-end gap-2">
            <a href="/organizations/<%= organization._id %>" class="btn btn-secondary">Cancel</a>
            <button type="submit" class="btn btn-warning">
              <i class="bi bi-save"></i> Save Changes
            </button>
          </div>
        </form>
      </div>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
